

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>node_action_server_ros_iot_bridge.py &mdash; Vargi Bots 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Config, msg and Action Files" href="iotconfig.html" />
    <link rel="prev" title="script" href="iotscripts.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Vargi Bots
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="implement.html">Implementation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">pkg_ros_iot_bridge</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="iotscripts.html">script</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">node_action_server_ros_iot_bridge.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iotconfig.html">Config, msg and Action Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#pkg-task5">pkg_task5</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vargi Bots</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">pkg_ros_iot_bridge</a> &raquo;</li>
        
          <li><a href="iotscripts.html">script</a> &raquo;</li>
        
      <li>node_action_server_ros_iot_bridge.py</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/rst/node_action_server_ros_iot_bridge.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-node_action_server_ros_iot_bridge">
<span id="node-action-server-ros-iot-bridge-py"></span><h1>node_action_server_ros_iot_bridge.py<a class="headerlink" href="#module-node_action_server_ros_iot_bridge" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="node_action_server_ros_iot_bridge.IotRosBridgeActionServer">
<em class="property">class </em><code class="descclassname">node_action_server_ros_iot_bridge.</code><code class="descname">IotRosBridgeActionServer</code><a class="reference internal" href="../_modules/node_action_server_ros_iot_bridge.html#IotRosBridgeActionServer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#node_action_server_ros_iot_bridge.IotRosBridgeActionServer" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the class for the Action Server which acts as a ROS-IoT Bridge</p>
<p>Receives the orders as MQTT requests, sends to the action client for processing and publishes the orders on the spreadsheet. 
Receives Goals from the client for publishing data on the spreadsheets after processing them.
Publishes data on the spreadsheet through HTTP requests.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_as</strong> – Action Server Object</li>
<li><strong>_config_mqtt_server_url</strong> – url of the hive mqtt server</li>
<li><strong>_config_mqtt_server_port</strong> – port of the hive mqtt server</li>
<li><strong>_config_mqtt_qos</strong> – mqtt quality of service</li>
<li><strong>_config_sub_order_topic</strong> – the mqtt topic on which orders are received</li>
<li><strong>_config_mqtt_sub_cb_ros_topic</strong> – the topic on which orders are sent to other ros nodes</li>
<li><strong>_config_google_apps_script</strong> – Apps Script deployment id of our google sheet</li>
<li><strong>_config_eyrc_google_apps_script</strong> – Apps Script deployment id of google sheet of eyrc</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="node_action_server_ros_iot_bridge.IotRosBridgeActionServer.mqtt_sub_callback">
<code class="descname">mqtt_sub_callback</code><span class="sig-paren">(</span><em>client</em>, <em>userdata</em>, <em>message</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/node_action_server_ros_iot_bridge.html#IotRosBridgeActionServer.mqtt_sub_callback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#node_action_server_ros_iot_bridge.IotRosBridgeActionServer.mqtt_sub_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a callback function for the MQTT Subscription which receives orders.
It then publishes the orders to the rostopic /ros_iot_bridge/mqtt/sub for processing.
It also publishes the Incoming Orders to the spreadsheet using HTTP protocol.
It stores all the data of orders in a dictionary orders_dict with order id as key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>message</strong> – the message received from mqtt topic</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="node_action_server_ros_iot_bridge.IotRosBridgeActionServer.on_cancel">
<code class="descname">on_cancel</code><span class="sig-paren">(</span><em>goal_handle</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/node_action_server_ros_iot_bridge.html#IotRosBridgeActionServer.on_cancel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#node_action_server_ros_iot_bridge.IotRosBridgeActionServer.on_cancel" title="Permalink to this definition">¶</a></dt>
<dd><p>This function will be called when Goal Cancel request is send to the Action Server</p>
</dd></dl>

<dl class="method">
<dt id="node_action_server_ros_iot_bridge.IotRosBridgeActionServer.on_goal">
<code class="descname">on_goal</code><span class="sig-paren">(</span><em>goal_handle</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/node_action_server_ros_iot_bridge.html#IotRosBridgeActionServer.on_goal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#node_action_server_ros_iot_bridge.IotRosBridgeActionServer.on_goal" title="Permalink to this definition">¶</a></dt>
<dd><p>This function will be called when Action Server receives a Goal.
It sends the goal to process_goal for further processing</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>goal_handle</strong> – goal_handle: the goal received from the action client</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="node_action_server_ros_iot_bridge.IotRosBridgeActionServer.process_goal">
<code class="descname">process_goal</code><span class="sig-paren">(</span><em>goal_handle</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/node_action_server_ros_iot_bridge.html#IotRosBridgeActionServer.process_goal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#node_action_server_ros_iot_bridge.IotRosBridgeActionServer.process_goal" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called as a separate thread to process Goal.</p>
<p>It receives the status of the package (like dispatched or shipped) and its order id.
Types(modes) of goals:</p>
<blockquote>
<div><ol class="arabic simple">
<li>inv: It receives the inventory as a string of dictionaries separated by “;”. It splits the string, stores them in a list and converts them into dictionaries. Then it is published to the Inventory sheet one by one.</li>
<li>disp: It receives the order id when it is dispatched. It searches the order from the order list(orders_dict) and publishes it to the OrdersDispatched sheet.</li>
<li>ship: It receives the order id when it is shipped. It searches the order from the order list(orders_dict) and publishes it to the OrdersShipped sheet.</li>
<li>fail: It receives the order id when it is not present in the inventory and sends the status NO in both OrdersDispatched and OrdersShipped sheets.</li>
</ol>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>goal_handle</strong> – the goal received from the action client</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="node_action_server_ros_iot_bridge.main">
<code class="descclassname">node_action_server_ros_iot_bridge.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/node_action_server_ros_iot_bridge.html#main"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#node_action_server_ros_iot_bridge.main" title="Permalink to this definition">¶</a></dt>
<dd><p>It is the main function which initializes the node and keeps the node running.</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="iotconfig.html" class="btn btn-neutral float-right" title="Config, msg and Action Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="iotscripts.html" class="btn btn-neutral float-left" title="script" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, vb_1844.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>